<!-- "Single Project" support -->
<Project InitialTargets="_FixMobileRazorContent">
  <PropertyGroup Condition=" '$(SingleProject)' == 'true' ">

    <!-- Android -->
    <EnableDefaultAndroidItems>false</EnableDefaultAndroidItems>
    <AndroidProjectFolder Condition=" '$(AndroidProjectFolder)' == '' ">Android\</AndroidProjectFolder>
    <AndroidManifest>$(AndroidProjectFolder)AndroidManifest.xml</AndroidManifest>
    <MonoAndroidResourcePrefix>$(AndroidProjectFolder)Resources</MonoAndroidResourcePrefix>
    <MonoAndroidAssetsPrefix>$(AndroidProjectFolder)Assets</MonoAndroidAssetsPrefix>
    
    <!-- iOS -->
    <EnableDefaultiOSItems>false</EnableDefaultiOSItems>
    <iOSProjectFolder Condition=" '$(iOSProjectFolder)' == '' ">iOS\</iOSProjectFolder>
    <IPhoneResourcePrefix Condition=" '$([MSBuild]::GetTargetPlatformIdentifier($(TargetFramework)))' == 'ios' ">$(iOSProjectFolder)Resources</IPhoneResourcePrefix>
    <_SingleProjectiOSExcludes>$(iOSProjectFolder)/**/.*/**</_SingleProjectiOSExcludes>

    <!-- MacCatalyst -->
    <EnableDefaultMacCatalystItems>false</EnableDefaultMacCatalystItems>
    <MacCatalystProjectFolder Condition=" '$(MacCatalystProjectFolder)' == '' ">MacCatalyst\</MacCatalystProjectFolder>
    <IPhoneResourcePrefix Condition=" '$([MSBuild]::GetTargetPlatformIdentifier($(TargetFramework)))' == 'maccatalyst' ">$(MacCatalystProjectFolder)Resources</IPhoneResourcePrefix>
    <_SingleProjectMacCatalystExcludes>$(MacCatalystProjectFolder)/**/.*/**</_SingleProjectMacCatalystExcludes>

    <!-- WinUI3 -->
    <EnableDefaultApplicationDefinition>false</EnableDefaultApplicationDefinition>
    <EnableDefaultPageItems>false</EnableDefaultPageItems>
    <WindowsProjectFolder Condition=" '$(WindowsProjectFolder)' == '' ">Windows\</WindowsProjectFolder>
    <_SingleProjectWindowsExcludes>$(WindowsProjectFolder)/**/.*/**</_SingleProjectWindowsExcludes>
    <OutputType Condition="'$(OutputType)' == 'Exe' And '$(MSBuildRuntime)' == 'Full' And $([MSBuild]::IsOSPlatform('windows'))">WinExe</OutputType>
  </PropertyGroup>

  <!-- Removals -->
  <ItemGroup Condition=" '$(EnableDefaultItems)' == 'true' and '$(SingleProject)' == 'true' ">

    <!-- Remove all Windows (WinUI) XAML Files from the Windows folder -->
    <EmbeddedResource
      Condition="'$(WindowsProjectFolder)' != ''"
      Remove="$(WindowsProjectFolder)**/*.xaml" />

    <Compile
        Condition=" '$(TargetPlatformIdentifier)' != 'android' and '$(AndroidProjectFolder)' != '' "
        Remove="$(AndroidProjectFolder)**/*$(DefaultLanguageSourceExtension)"
    />
    <Compile
        Condition=" '$(TargetPlatformIdentifier)' != 'ios' and '$(iOSProjectFolder)' != '' "
        Remove="$(iOSProjectFolder)**/*$(DefaultLanguageSourceExtension)"
    />
    <Compile
        Condition=" '$(TargetPlatformIdentifier)' != 'maccatalyst' and '$(MacCatalystProjectFolder)' != '' "
        Remove="$(MacCatalystProjectFolder)**/*$(DefaultLanguageSourceExtension)"
    />

    <Compile
        Condition=" '$(TargetPlatformIdentifier)' != 'windows' and '$(WindowsProjectFolder)' != '' "
        Remove="$(WindowsProjectFolder)**/*$(DefaultLanguageSourceExtension)"
    />

  </ItemGroup>

  <!-- IDE capabilities -->
  <ItemGroup Condition=" '$(SingleProject)' == 'true' ">
    <ProjectCapability Include="MauiSingleProject" />
    <ProjectCapability Include="LaunchProfiles" />
  </ItemGroup>

  <!--Fix @(Content) for .razor files on Android -->
  <Target Name="_FixMobileRazorContent" Condition=" '$(TargetPlatformIdentifier)' == 'android' or '$(TargetPlatformIdentifier)' == 'ios' or '$(TargetPlatformIdentifier)' == 'maccatalyst' ">
    <ItemGroup>
      <RazorComponent
          Condition=" '%(Content.Extension)' == '.razor' "
          Include="@(Content)"
      />
      <Content
          Condition=" '%(Content.Extension)' == '.razor' "
          Remove="@(Content)"
      />
    </ItemGroup>
  </Target>

</Project>
